
{
    "AWSTemplateFormatVersion" : "2010-09-09_riddhi",

    "Description": "AWS CloudFormation Sample Template vpc_multiple_subnets.template: Sample template showing how to create a VPC with multiple subnets. The first subnet is public and contains the load balancer, the second subnet is private and contains an EC2 instance behind the load balancer",
    
    "Parameters" : {
                    "CidrBlock":{
                        "Description" : "VPC Subnet, like 10.0.0.0/16",
                        "Type" : "String",
                        "Default" :  "10.0.0.0/16",
                                },
                    "SubnetCIDR1":{
                        "Description" : "Public Subnet, like 10.0.0.0/24",
                        "Type" : "String",
                        "Default" :  "10.0.0.0/24",
                                  },
                    "SubnetCIDR2":{
                        "Description" : "Public Subnet, like 10.0.1.0/24",
                        "Type" : "String",
                        "Default" :  "10.0.1.0/24",
                                  },
                    "SubnetCIDR3":{
                        "Description" : "Private Subnet, like 10.0.1.0/24",
                        "Type" : "String",
                        "Default" :  "10.0.2.0/24",
                                  },
                    "DestinationCidrBlock":{
                        "Description" : "destination CIDR block, 0.0.0.0/0",
                        "Type" : "String",
                        "Default" :  "0.0.0.0/0",
                                  }              
                  },

    "Resources" : {
        "VPC" : {
           "Type" : "AWS::EC2::VPC",
           "Properties" : {
               "CidrBlock" : {"Ref": "CidrBlock"},  
          	   "EnableDnsSupport" : "false",
          	   "EnableDnsHostnames" : "false",
               "InstanceTenancy" : "dedicated",
               "Tags" : [{"Key" : "Name", 
                          "Value" : {"Fn::Join":
                                            ["",{"Ref": "AWS::StackName"}, "-csye6225", "-vpc"]

                                    }
                        }]
                          }
         },
                    
        "Subnet1": {
                "Type": "AWS::EC2::VPC",
                "Properties": {
                    "AvailabilityZone": "us-east-2a",   //ohio
                    "CidrBlock": {"Ref":"SubnetCIDR1"}, 
                    "Tags": [{
                            "Key": "Name",
                            "Value": {"Fn::Join":
                                            [{"Ref": "AWS::StackName"}, "-us-east-1a"]}
                             }],
                    "VpcId": {"Ref": "VPC"}
                }
         },
        "Subnet2": {
                "Type": "AWS::EC2::Subnet",
                "Properties": {
                    "AvailabilityZone": "us-east-2b",   //ohio
                    "CidrBlock": {"Ref":"SubnetCIDR2"}, 
                    "Tags": [{
                            "Key": "Name",
                            "Value": {"Fn::Join":
                                            [{"Ref": "AWS::StackName"}, "-us-east-1b"]}
                             }],
                    "VpcId": {"Ref": "VPC"}
                }
         },

         "Subnet3": {
                "Type": "AWS::EC2::Subnet",
                "Properties": {
                    "AvailabilityZone": "us-east-2c",   //ohio
                    "CidrBlock" : {"Ref":"SubnetCIDR3"}, 
                    "Tags": [{
                            "Key": "Name",
                            "Value": {"Fn::Join":
                                            [{"Ref": "AWS::StackName"}, "-us-east-1c"]}
                             }],
                    "VpcId": {"Ref": "VPC"}
                }
         },  
      //Internet gateway
       "InternetGateway":{
       "Type" : "AWS::EC2::InternetGateway",
       "Properties" : {
              "Tags": [{
                       "Key": "Name",
                       "Value": {"Fn::Join":
                                      [{"Ref": "AWS::StackName"}, "-ig"]}
                       }]
            }
          },//close ig
        //Internet gateway attachment
        "InternetGatewayAttachment": {
                    "Type": "AWS::EC2::VPCGatewayAttachment",
                    "Properties": {
                        " InternetGatewayId": {"Ref": "InternetGateway"},
                        "VpcId": {"Ref": "VPC"}
                                  }
                              },  //iga closed

        "RouteTable":{
           "Type" : "AWS::EC2::RouteTable",
           "Properties" : {
              "VpcId" : {"Ref": "VPC"},
              "Tags" : [{
                       "Key": "Name",
                       "Value": {"Fn::Join":
                                      [{"Ref": "AWS::StackName"}, "-rt"]}
                       }]
           }
        }, 
         "Subnet1RouteTableAssociation": {
                    "Type": "AWS::EC2::SubnetRouteTableAssociation",
                    "Properties": {
                        "RouteTableId": {"Ref": "RouteTable"},
                        "SubnetId": {
                            "Ref": "Subnet1"
                        }
                    }
                },
          "Subnet1RouteTableAssociation": {
                    "Type": "AWS::EC2::SubnetRouteTableAssociation",
                    "Properties": {
                        "RouteTableId": {"Ref": "RouteTable"},
                        "SubnetId": {
                            "Ref": "Subnet2"
                        }
                    }
                },
          "Subnet1RouteTableAssociation": {
                    "Type": "AWS::EC2::SubnetRouteTableAssociation",
                    "Properties": {
                        "RouteTableId": {"Ref": "RouteTable"},
                        "SubnetId": {
                            "Ref": "Subnet3"
                        }
                    }
                }, 
          "PublicRoute":{
            "Type" : "AWS::EC2::Route",
            "Properties" : {
              "DestinationCidrBlock" : {"Ref": "DestinationCidrBlock"},
              "GatewayId" : "InternetGateway",
              "RouteTableId" : "RouteTable",
                           }
                         }
      } //close Resources  

}
